<!DOCTYPE html>
<html lang="fa">

<head>
    <meta charset="UTF-8">
    <title>پلنر درسی</title>
    <style>
        body {
            font-family: Vazirmatn, sans-serif;
            direction: rtl;
            background-color: #f0f4f8;
            padding: 2rem;
            display: flex;
            gap: 2rem;
            justify-content: center;
        }

        form {
            width: 400px;
            background: white;
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        label {
            font-weight: bold;
            margin-top: 1rem;
            display: block;
        }

        select,
        input[type="text"],
        input[type="date"],
        input[type="time"],
        button {
            width: 100%;
            padding: 0.6rem;
            margin-top: 0.3rem;
            border-radius: 0.5rem;
            border: 1px solid #ccc;
            font-size: 1rem;
        }

        .time-block {
            margin-top: 1rem;
            background-color: #eef2f7;
            padding: 1rem;
            border-radius: 0.75rem;
        }

        .time-block select {
            width: 48%;
            display: inline-block;
            margin-top: 0.5rem;
        }

        .time-block select:first-child {
            margin-left: 4%;
        }

        button {
            background-color: #3b82f6;
            color: white;
            font-weight: bold;
            margin-top: 2rem;
            transition: background 0.2s;
        }

        button:hover {
            background-color: #2563eb;
        }

        .schedule-box {
            width: 700px;
            background: white;
            padding: 1rem;
            border-radius: 1rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            table-layout: fixed;
        }

        th,
        td {
            border: 1px solid #ccc;
            text-align: center;
            padding: 0.5rem;
            font-size: 0.9rem;
        }

        th {
            background-color: #e0e7ff;
        }

        .day-header {
            font-weight: bold;
            background-color: #f3f4f6;
        }
    </style>
</head>

<body>

    <form id="course-form" action="/planner/add-course/" method="POST">
        {% csrf_token %}
        <label for="course_name">نام درس</label>
        <input type="text" id="course_name" name="course_name" required>

        <label for="units">تعداد واحد</label>
        <select id="units" name="units" onchange="updateTimeFields()" required>
            <option value="">انتخاب کنید</option>
            <option value="1">۱ واحد</option>
            <option value="2">۲ واحد</option>
            <option value="3">۳ واحد</option>
        </select>

        <div id="time-fields"></div>

        <label for="exam_date">تاریخ امتحان</label>
        <input type="date" id="exam_date" name="exam_date" required>

        <label for="exam_time">ساعت امتحان</label>
        <input type="time" id="exam_time" name="exam_time" required>

        <button type="button" onclick="addCourse(event)">افزودن درس</button>
    </form>

    <div class="schedule-box">
        <table id="courses-table">
            <thead>
                <tr>
                    <th>روز / ساعت</th>
                    <th>08:00 - 09:30</th>
                    <th>09:30 - 11:00</th>
                    <th>13:30 - 15:00</th>
                    <th>15:00 - 16:30</th>
                    <th>16:30 - 18:00</th>
                    <th>18:00 - 19:30</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td class="day-header">شنبه</td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <!-- Other rows for days -->
            </tbody>
        </table>
    </div>

    <script>
        function updateTimeFields() {
            const unit = parseInt(document.getElementById("units").value);
            const timeFieldsContainer = document.getElementById("time-fields");

            timeFieldsContainer.innerHTML = '';

            const count = (unit === 3) ? 2 : (unit === 1 || unit === 2) ? 1 : 0;

            for (let i = 0; i < count; i++) {
                const block = document.createElement("div");
                block.className = "time-block";

                const daySelect = document.createElement("select");
                daySelect.name = `day${i}`;
                daySelect.required = true;
                daySelect.innerHTML = `
                    <option value="">انتخاب روز</option>
                    <option value="شنبه">شنبه</option>
                    <option value="یکشنبه">یکشنبه</option>
                    <option value="دوشنبه">دوشنبه</option>
                    <option value="سه‌شنبه">سه‌شنبه</option>
                    <option value="چهارشنبه">چهارشنبه</option>
                `;

                const timeSelect = document.createElement("select");
                timeSelect.name = `time${i}`;
                timeSelect.required = true;
                timeSelect.innerHTML = `
                    <option value="">انتخاب ساعت</option>
                    <option value="08:00">08:00 - 09:30</option>
                    <option value="09:30">09:30 - 11:00</option>
                    <option value="13:30">13:30 - 15:00</option>
                    <option value="15:00">15:00 - 16:30</option>
                    <option value="16:30">16:30 - 18:00</option>
                    <option value="18:00">18:00 - 19:30</option>
                `;

                block.appendChild(daySelect);
                block.appendChild(timeSelect);
                timeFieldsContainer.appendChild(block);
            }
        }

        function addCourse(event) {
            event.preventDefault();

            const courseData = new FormData(document.getElementById("course-form"));
            const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;

            fetch('/planner/add-course/', {
                method: 'POST',
                headers: {
                    'X-CSRFToken': csrftoken
                },
                body: courseData,
            })
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        alert(data.error);
                    } else {
                        updateTable(data);
                    }
                })
                .catch(error => console.error('Error:', error));
        }

        function updateTable(course) {
            const table = document.getElementById("courses-table");
            const row = table.insertRow();
            row.insertCell(0).textContent = course.course_name;
            row.insertCell(1).textContent = course.units;
            row.insertCell(2).textContent = course.days.join(', ');
            row.insertCell(3).textContent = course.times.join(', ');
            row.insertCell(4).textContent = course.exam_date;
            row.insertCell(5).textContent = course.exam_time;
        }
    </script>

</body>

</html>